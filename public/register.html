<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My document</title>
    <script type="text/javascript" src="js/index.js"></script>
  </head>

  <body>
    <form>
      <input
        type="text"
        id="firstname"
        placeholder="Firstname"
        autocomplete="off"
        required
      />
      <input
        type="text"
        id="lastname"
        placeholder="Lastname"
        autocomplete="off"
        required
      />
      <input
        type="email"
        id="email"
        placeholder="E-mail"
        autocomplete="off"
        required
      />
      <input
        type="password"
        id="pw"
        placeholder="Password"
        autocomplete="off"
        required
      />
      <input
        type="password"
        id="pwrepeat"
        placeholder="Repeat Password"
        autocomplete="off"
        minlength="8"
        maxlength="12"
        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
        required
      />
      <button type="submit" id="create">Submit</button>
    </form>
    <h3 id="result">Result ...</h3>
  </body>

  <script>
    let firstname = document.getElementById("firstname");
    let lastname = document.getElementById("lastname");
    let email = document.getElementById("email");
    let password = document.getElementById("pw");
    let passwordrepeat = document.getElementById("pwrepeat");
    let create = document.getElementById("create");
    let result = document.getElementById("result");
    let form = document.querySelector("form");

    form.addEventListener("submit", async function(evt) {
      evt.preventDefault();
      console.log(checkRegisterInput());
      console.log(checkPasswords());
      if (checkRegisterInput() && checkPasswords()) {
        console.log("does it");
        let url = "http://localhost:3000/users";

        let userData = {
          firstname: firstname.value,
          lastname: lastname.value,
          email: email.value,
          password: password.value
        };

        let cfg = {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(userData)
        };

        try {
          let data = await utilities.requestToServer(url, cfg);
          result.innerHTML = data.msg;
        } catch (err) {
          console.log(err);
        }
      }
    });

    function checkRegisterInput() {
      if (
        utilities.isValidInput(firstname.value) &&
        utilities.isValidInput(lastname.value)
      ) {
        return true;
      } else {
        console.log(
          "Please input valid first and last name - no special characters!"
        );
        return false;
      }
    }

    function checkPasswords() {
      if (password.value == passwordrepeat.value) {
        return true;
      } else {
        console.log("Passwords do not match.");
        return false;
      }
    }
  </script>
</html>
